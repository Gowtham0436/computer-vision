{% extends "base.html" %}
{% block title %}Module 5-6 - Problem 2{% endblock %}
{% block header %}Module 5-6 - Problem 2{% endblock %}
{% block subheader %}Real-time Object Tracking{% endblock %}

{% block styles %}
<style>
  .main-container { max-width: 1400px; margin: 0 auto; }
  .controls { margin-bottom: 20px; padding: 20px; background: #f5f5f5; border-radius: 10px; }
  .mode-selector { margin-bottom: 15px; }
  .mode-selector label { font-weight: bold; margin-right: 10px; color: #555; }
  .mode-selector select { padding: 8px 15px; border: 2px solid #667eea; border-radius: 5px; font-size: 16px; background: white; cursor: pointer; }
  .button-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
  .sam2-controls { margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 5px; display: none; }
  .sam2-controls label { font-weight: bold; margin-right: 10px; color: #555; }
  .sam2-controls input[type="file"] { margin-right: 10px; padding: 5px; }
  .video-container { position: relative; width: 100%; max-width: 800px; margin: 20px auto; background: #000; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
  #video { width: 100%; display: block; }
  #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: auto; cursor: crosshair; }
  #status { position: absolute; top: 10px; left: 10px; background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 15px; border-radius: 5px; font-size: 14px; z-index: 10; }
  .info { margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 10px; border-left: 4px solid #667eea; }
  .info h3 { color: #333; margin-bottom: 10px; }
  .info ul { list-style-position: inside; color: #555; line-height: 1.8; }
  .info li { margin-bottom: 8px; }
</style>
{% endblock %}

{% block content %}
<div class="main-container">
  <div style="margin-bottom: 20px;">
    <a href="/module5_6" class="btn">‚Üê Back to Module 5-6</a>
    <a href="/modules" class="btn">All Modules</a>
  </div>

  <h2>Problem 2: Real-time Object Tracking</h2>
  <p style="line-height: 1.8; margin-bottom: 20px;">
    Three implementations of object tracking with live camera feed:
    <strong>(i)</strong> Marker-based (ArUco/QR), <strong>(ii)</strong> Markerless, <strong>(iii)</strong> SAM2 segmentation-based.
  </p>

  <div class="controls">
    <div class="mode-selector">
      <label>Tracking Mode:</label>
      <select id="trackingMode">
        <option value="marker">Marker-Based (ArUco/QR)</option>
        <option value="markerless">Marker-Less</option>
        <option value="sam2">SAM2 Segmentation</option>
      </select>
    </div>
    
    <div class="button-group">
      <button id="startBtn" class="btn btn-success">Start Camera</button>
      <button id="stopBtn" class="btn btn-danger" disabled>Stop Camera</button>
      <button id="selectRegionBtn" class="btn" disabled>Select Region</button>
    </div>
    
    <div id="sam2Controls" class="sam2-controls">
      <label>Load SAM2 NPZ File:</label>
      <input type="file" id="sam2File" accept=".npz">
      <button id="loadSam2Btn" class="btn">Load Segmentation</button>
      <span style="margin: 0 10px; color: #666;">OR</span>
      <button id="selectObjectBtn" class="btn" style="background: #9c27b0;">Select Object to Track</button>
    </div>
  </div>
  
  <div class="video-container">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" willReadFrequently="true"></canvas>
    <div id="status">Status: Ready</div>
  </div>
  
    <div class="info">
    <h3>Instructions:</h3>
    <ul>
      <li><strong>Marker-Based:</strong> Show an ArUco marker or QR code to the camera</li>
      <li><strong>Marker-Less:</strong> Click "Select Region" to select an object to track</li>
      <li><strong>SAM2:</strong> Load a pre-computed NPZ file OR click "Select Object to Track" to draw a box around the object you want to track</li>
    </ul>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://docs.opencv.org/4.8.0/opencv.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="{{ url_for('static', filename='js/module5_6/npz_parser.js') }}"></script>
<script src="{{ url_for('static', filename='js/module5_6/tracker.js') }}"></script>
<script src="{{ url_for('static', filename='js/module5_6/app.js') }}"></script>
{% endblock %}

